<section class = "section">
    <h2 class = "heading">
        ✨ Our Products ✨
    </h2>
    <form class = "search-form">
        <label
            class = "search-label"
            for = "default-search"
        >Search</label>
        <div class = "search-container">
            <div class = "search-icon">
                <svg
                    aria-hidden = "true"
                    class = "w-4 h-4 text-gray-500 dark:text-gray-400"
                    fill = "none"
                    viewBox = "0 0 20 20"
                    xmlns = "http://www.w3.org/2000/svg"
                >
                    <path
                        d = "m19 19-4-4m0-7A7 7 0 1 1 1 8a7 7 0 0 1 14 0Z"
                        stroke = "currentColor"
                        stroke-linecap = "round"
                        stroke-linejoin = "round"
                        stroke-width = "2"
                    />
                </svg>
            </div>
            <input
                [(ngModel)] = "searchInput"
                class = "search-input"
                id = "default-search"
                name = "searchInput"
                placeholder = "Search Men's Fashion, Women's Fashion..."
                required
                type = "search"
            />
        </div>
    </form>
    <div class = "filter-container">
        <select
            [(ngModel)] = "selectedCategory"
            class = "select-input"
        >
            <option
                disabled
                selected
                value = ""
            >Select a category
            </option>
            @for (category of categories; track category.name) {
                <option [value] = "category.name">{{ category.name }}</option>
            } @empty {
                <option>No categories available</option>
            }
        </select>

        <input
            [(ngModel)] = "selectedPrice"
            class = "number-input"
            placeholder = "Enter max price"
            type = "number"
        />

        <button
            (click) = "filterProducts()"
            class = "filter-button"
        >
            Filter
        </button>
        <button
            (click) = "resetFilters()"
            class = "reset-button"
        >
            Reset
        </button>
    </div>

    <div class = "card-container">
        @for (product of filteredProducts| search :searchInput; track product.id) {
            <div class = "card">
                <div
                    [routerLink] = "['/details', product.id]"
                    class = "card-link"
                >
                    <div class = "card-content">
                        <img
                            class = "card-image"
                            [src] = "product.imageCover"
                            [alt] = "product.title"
                        />
                        <div class = "card-info">
                            <div class = "card-title">
                                {{ product.title.split(" ", 2).join(" ") }}
                            </div>
                            <div class = "px-3 py-2 text-sm text-gray-700 dark:text-gray-300">
                                <p class = "mt-1">
                                    <strong class = "product-category-label">Category:</strong>
                                    {{ product.category?.name || 'Unknown' }}
                                </p>
                                <p class = "mt-1">
                                    <strong class = "product-brand-label">Brand:</strong>
                                    {{ product.brand?.name || 'No Brand' }}
                                </p>
                            </div>

                            <div class = "card-footer">
                                <div class = "card-price">
                                    {{ product.price | currency:'GBP':'symbol':'1.0-0' }}
                                </div>
                                <div class = "card-rating flex items-center">
                                    <div class = "flex">
                                        @for (n of [ 1, 2, 3, 4, 5 ]; track n) {
                                            @if (n <= Math.floor(product.ratingsAverage)) {
                                                <i class = "fa fa-star text-yellow-400"></i>
                                            } @else if (n - 0.5 <= product.ratingsAverage) {
                                                <i class = "fa fa-star-half-alt text-yellow-400"></i>
                                            } @else {
                                                <i class = "fa fa-star text-gray-300"></i>
                                            }
                                        }
                                    </div>
                                    <span class = "text-gray-800 font-medium dark:text-white mr-2">{{ product.ratingsAverage }}</span>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
                <div class = "pt-2 flex justify-center items-center gap-[3%]">
                    <button
                        (click) = "addProductToCart(product.id)"
                        class = "add-to-cart-btn-product"
                    >
                        Add To Cart
                    </button>
                    <button
                        (click) = "addProductToWishlist(product.id)"
                        class = "wishlist-btn"
                    >
                        <i class = "fa fa-heart"></i>
                    </button>
                </div>

            </div>
        }
    </div>
</section>
